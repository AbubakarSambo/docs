<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from stripe.com/docs/connect/oauth by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 09 Feb 2015 07:33:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Integrating OAuth</title>
    <link rel="stylesheet" type="text/css" href="../../assets/site-ea99019a1bc27872a48d1149a4785b01.css" media="screen" />
    <script type="text/javascript">
        var _sf_startpt=(new Date()).getTime()
        var APIValues = {};
    </script>
    <script type="application/json" id="mixpanel_config">{&quot;identifier&quot;:&quot;eb71b6171a4f7ed97de9b7a0395b7ca5&quot;}</script>
<script type="application/json" id="analytics_config">{}</script>
<script src="../../../www.googleadservices.com/pagead/f.txt"></script>
<script src="../../assets/external_analytics-a9e3d39cd6110aa8c184d9c1f2e5777e.js"></script>
<script src="../../assets/qframe-cb903dc9166e266dc7d9f11d44f5e81a.js"></script>

    <link rel="shortcut icon" href="https://stripe.com/favicon.ico">

    <!--[if lt IE 9]>
    <script src="/assets/html5shiv-17761200a17ebcb716dda86cca6d2472.js"></script>
    <![endif]-->
    <script type="text/javascript" src="../../../use.typekit.net/gbh7uto.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    
</head>
<body id="documentation">

  <div id="header">
    <h1><a href="https://stripe.com/">Stripe</a></h1>
    <div class="navigation">
    <div class="signin"><a id='signin' href="https://dashboard.stripe.com/login"><span>Sign In</span></a></div>

  <ul class="global">
    <li><a href="https://stripe.com/docs" class="selected">Documentation</a></li>
    <li><a href="https://support.stripe.com/">Help &amp; Support</a></li>
  </ul>
</div>

  </div><!-- #header -->

  <section id="doc">

    <nav>

      <h1 class="getting-started">Documentation</h1>
      <ul>
        <li class="unselected">
          <a href="https://stripe.com/docs">Getting Started</a>
        </li>
          <li class="unselected sub">
            <a href="../tutorials/checkout.html">Embedded Form</a>
          </li>
          <li class="unselected sub">
            <a href="../tutorials/forms.html">Custom Forms</a>
          </li>
          <li class="unselected sub">
            <a href="../mobile.html">Mobile Apps</a>
          </li>

        <li class="unselected">
          <a href="../tutorials/charges.html">Charging Cards</a>
        </li>

        <li class="unselected">
          <a href="../tutorials/sending-transfers.html">Sending Transfers</a>
        </li>

        <li class="unselected">
          <a href="../tutorials/dashboard.html">Your Account</a>
        </li>
      </ul>

      <h1 class="references">References</h1>
      <ul>
        <li class="unselected">
          <a href="../stripe.html">Stripe.js</a>
        </li>
        <li class="unselected">
          <a href="../checkout.html">Checkout</a>
        </li>
        <li class="unselected">
          <a href="../webhooks.html">Webhooks</a>
        </li>
        <li class="unselected">
          <a href="../fraud.html">Fraud Protection</a>
        </li>
        <li class="unselected">
          <a href="../testing.html">Testing</a>
        </li>
        <li class="unselected">
          <a href="../examples.html">Examples</a>
        </li>
        <li class="unselected">
          <a href="../upgrades.html">API Upgrades</a>
        </li>
        <li class="unselected">
          <a href="../libraries.html">API Libraries</a>
        </li>
        <li class="unselected">
          <a href="../guides/file-upload.html">File Upload Guide</a>
        </li>
        <li class="unselected">
          <a href="../api.html" class="external" target="_blank">
            Full API Reference
          </a>
        </li>
      </ul>

      <h1 class="subscriptions">Subscriptions</h1>
      <ul>
        <li class="unselected">
          <a href="../subscriptions.html">Overview</a>
        </li>
        <li class="unselected">
          <a href="../tutorials/subscriptions.html">Getting Started</a>
        </li>
        <li class="unselected">
          <a href="../guides/subscriptions.html">Integration Guide</a>
        </li>
      </ul>

      <h1 class="connect">Connect</h1>
      <ul>
        <li class="unselected">
          <a href="../connect.html">Overview</a>
        </li>
        <li class="unselected">
          <a href="getting-started.html">Getting Started</a>
        </li>
        <li class="selected">
          <a href="oauth.html">Integrating OAuth</a>
        </li>
        <li class="unselected">
          <a href="collecting-fees.html">Collecting Fees</a>
        </li>
        <li class="unselected">
          <a href="shared-customers.html">Shared Customers</a>
        </li>
        <li class="unselected">
          <a href="reference.html">Reference</a>
        </li>
      </ul>

      <h1 class="disputes">Disputes</h1>
      <ul>
        <li class="unselected">
          <a href="https://stripe.com/help/disputes-overview">Overview</a>
        </li>
        <li class="unselected">
          <a href="../guides/dispute-evidence.html">Submitting Evidence</a>
        </li>
        <li class="unselected">
          <a href="https://stripe.com/help/dispute-types">Dispute Types</a>
        </li>
        <li class="unselected">
          <a href="https://stripe.com/help/disputes">FAQ</a>
        </li>
      </ul>


      <h1 class="faq"><abbr title="Frequently Asked Questions">FAQ</abbr></h1>
      <ul>
        <li class="unselected">
          <a href="https://stripe.com/help/transfers">Getting Paid</a>
        </li>
        <li class="unselected">
          <a href="https://stripe.com/help/ssl">SSL/TLS</a>
        </li>
        <li class="unselected">
          <a href="https://stripe.com/help/security">Security</a>
        </li>
      </ul>

      <h1 class="more">More</h1>
      <ul>
        <li class="unselected">
          <a href="https://stripe.com/help/contact">Contact</a>
        </li>
        <li class="unselected">
          <a href="https://stripe.com/global">Global Users</a>
        </li>
        <li class="unselected">
          <a href="https://stripe.com/gallery">Gallery</a>
        </li>
        <li class="last unselected">
          <a href="../integrations.html">Integrations</a>
        </li>
      </ul>

    </nav>

    <section id="content">
      <section id="details">

<header>
  <h1>Integrating OAuth</h1>
  <p>
    This tutorial will help you integrate the Stripe Connect OAuth flow into your application.
    If you need help, check out our answers to <a href="https://support.stripe.com/">common questions</a> or chat live with other developers in #stripe on freenode.

  </p>
</header>
<article>

<p class="notification">This tutorial assumes you have already <a href="getting-started.html#register-application" class="arrow">registered an application</a></p>

<aside class="content note">
  <h1>OAuth 2.0</h1>

  <p>For additional reading, feel free to head over to the <a href="https://tools.ietf.org/html/rfc6749">official OAuth 2.0 spec</a>.</p>

  <p>There's also a <a href="http://oauth.net/2/">list of OAuth 2.0 clients</a> if you'd rather not implement the details yourself.</p>
</aside>

<p>Stripe Connect supports the <a href="http://oauth.net/2/">OAuth 2.0 protocol</a>. Once your users connect with Stripe, your application will be able to make API requests on their behalf without requiring their user credentials or API keys.</p>

<h1>How it works</h1>

<p>When a user on your site wants to connect with Stripe, you'll send them to us with your application's <code>client_id</code>. They'll be prompted to connect their Stripe account, and afterwards, we will redirect them back to your <code>redirect_uri</code> with an authorization code or an error (if the authorization was denied).</p>

<p>You can then trade that authorization code for an <code>access_token</code> by making a request to our OAuth token endpoint. An <code>access_token</code> can be used as a Stripe API key.</p>

<hr />

<h1>Implementing the flow</h1>

<aside class="content note">
  <h1>Stripe Connect reference</h1>

  <p>Check out the <a href="reference.html">reference guide</a> for more details on request and response parameters.</p>
</aside>

<p>The relevant Stripe endpoints are:</p>

<ul>
  <li><code>authorize_url</code>: <strong>https://connect.stripe.com/oauth/authorize</strong></li>
  <li><code>access_token_url</code>: <strong>https://connect.stripe.com/oauth/token</strong></li>
</ul>

<p>
The <code>redirect_uri</code> is an endpoint configured in your <a href="https://dashboard.stripe.com/account/applications/settings">application settings</a>; we will redirect the user and pass the authorization code there after authorization. You may also specify a comma-separated list of allowed redirect uri's in your application settings and pass a <code>redirect_uri</code> parameter to your authorize request.</p>

<h2>Application Settings</h2>

<p>

You can find your <code>client_id</code>s and edit details like your application name, url, logo, and <code>redirect_uri</code> in your <a href="https://dashboard.stripe.com/account/applications/settings">application settings</a>.</p>

<p>Here, your users will also be able to view connected applications with their respective permission levels and revoke application authorizations.</p>

<h2>Connecting users</h2>

<p>When you're ready to have your users connect with Stripe, show a <a href="https://stripe.com/about/branding">Stripe Connect button</a> that sends them to our <code>authorize_url</code> endpoint:</p>

<section class="code-example">
  <div class="terminal-wrap allow-wrap">
  <pre><code><span class="highlight_js bash">https://connect.stripe.com/oauth/authorize?response_type=code&amp;client_id=ca_32D88BD1qLklliziD7gYQvctJIhWBSQ7&amp;scope=read_write&amp;state=1234</span></code></pre>
  </div>
</section>

<p>For example:</p>
    <p><a href="https://connect.stripe.com/oauth/authorize?response_type=code&amp;scope=read_write&amp;stripe_landing=login&amp;client_id=ca_32D88BD1qLklliziD7gYQvctJIhWBSQ7" class="stripe-connect"><span>Connect with Stripe</span></a></p>

<p>There are a couple of <a href="reference.html#get-authorize">special parameters</a> you can use here:</p>
<ul>
  <li><code>state</code>: We'll pass this parameter back to you on redirect (useful for CSRF protection or identifying users)</li>
  <li><code>stripe_landing</code>: Determines whether to show a login screen or account application by default. If you're assuming your users will already have existing Stripe accounts, you should pass in <code>stripe_landing=login</code>.
</ul>

<p>We'll prompt the user to allow or deny your application, then send them back to your <code>redirect_uri</code> along with the authorization code:</p>


<section class="code-example">
  <div class="terminal-wrap allow-wrap">
  <pre><code><span class="highlight_js bash">HTTP/1.1 302 Found
Location: https://stripe.com/connect/default/oauth/test?scope=read_write&amp;state=1234&amp;code=AUTHORIZATION_CODE</span></code></pre>
  </div>
</section>

  <p>Or, if the authorization was denied, we'll include an error instead:</p>

<section class="code-example">
  <div class="terminal-wrap allow-wrap">
  <pre><code><span class="highlight_js bash">HTTP/1.1 302 Found
Location: https://stripe.com/connect/default/oauth/test?error=access_denied&amp;error_description=The%20user%20denied%20your%20request</span></code></pre>
  </div>
</section>

<p>
For more details on the redirect parameters, see the <a href="reference.html#get-authorize-response">reference guide</a>.</p>

<h2 id="token-request">After the user has connected</h2>

<p>Using the <code>code</code> parameter we sent back to your <code>redirect_uri</code> endpoint, you should make a <code>POST</code> request to our <code>access_token_url</code> endpoint:</p>

<section class="code-example">
<div class="terminal-wrap">
<pre><code><span class="highlight_js bash">curl -X POST https://connect.stripe.com/oauth/token \
  -d client_secret=sk_test_BQokikJOvBiI2HlWgH4olfQ2 \
  -d code=AUTHORIZATION_CODE \
  -d grant_type=authorization_code</span></code></pre>
</div>
</section>

<p>Note that you'll make the request with your live secret API key or test secret API key, depending on whether you want to get a live or test access token back. Stripe will return a response containing the <code>access_token</code> or an error.</p>


<section class="code-example">
<div class="terminal-wrap">
<pre><code><span class="highlight_js json">{
  &quot;token_type&quot;: &quot;bearer&quot;,
  &quot;stripe_publishable_key&quot;: PUBLISHABLE_KEY,
  &quot;scope&quot;: &quot;read_write&quot;,
  &quot;livemode&quot;: false,
  &quot;stripe_user_id&quot;: USER_ID,
  &quot;refresh_token&quot;: REFRESH_TOKEN,
  &quot;access_token&quot;: ACCESS_TOKEN
}</span></code></pre>
</div>
</section>

<section class="code-example">
<div class="terminal-wrap">
<pre><code><span class="highlight_js json">{
  &quot;error&quot;: &quot;invalid_grant&quot;,
  &quot;error_description&quot;: &quot;Authorization code does not exist: AUTHORIZATION_CODE&quot;
}</span></code></pre>
</div>
</section>

<p>You're done! You can now use this <code>access_token</code> as you would normally use a Stripe secret API key:</p>

<section class="code-example">
<div class="terminal-wrap">
<pre><code><span class="highlight_js bash">curl https://api.stripe.com/v1/charges \
  -u ACCESS_TOKEN: \
  -d amount=400 \
  -d currency=usd \
  -d description=Charge for you@stripe.com \
  -d card=TOKEN_ID</span></code></pre>
</div>
</section>

<p>You'll notice that the response also includes a <code>refresh_token</code>, which you can use to <a href="#test-keys-for-livemode-applications">generate test access tokens</a> for a production <code>client_id</code> or to roll your access token. You should hold on to this, as you're only able to get it with this first <code>POST</code>.</p>

<h2 id="request-api-keys">Using access tokens</h2>

<p>
When using our official <a href="../libraries.html">API libraries</a>, we recommend that you pass in the <code>access_token</code> with every request, instead of setting the API key globally. This is because the <code>access_token</code> used in any API request depends on the user you're charging on behalf of.
</p>

<section class="code-example">
<nav class="lang-control">
  <a href="https://stripe.com/docs/connect/.">ruby</a>
  <a href="https://stripe.com/docs/connect/.">python</a>
  <a href="https://stripe.com/docs/connect/.">php</a>
  <a href="https://stripe.com/docs/connect/.">node</a>
</nav><div class="terminal-wrap" data-action="tutorial_connect_api_key">
  <pre><code><div class="terminal"></div></code></pre>
</div>
</section>

<h2 id='test-keys-for-livemode-applications'>Generating test keys for livemode applications</h2>

<p>You may generate only test access tokens using a development <code>client_id</code>, but may generate either live or test access tokens using a production <code>client_id</code>.</p>

<p>If you want to generate test access tokens for a production <code>client_id</code>, you can do so using a <code>refresh_token</code>:</p>

<section class="code-example">
<div class="terminal-wrap">
<pre><code><span class="highlight_js bash">curl -X POST https://connect.stripe.com/oauth/token \
  -d client_secret=sk_test_BQokikJOvBiI2HlWgH4olfQ2 \
  -d refresh_token=REFRESH_TOKEN \
  -d grant_type=refresh_token</span></code></pre>
</div>
</section>

<h2>Publishable keys</h2>

<p>Don't forget that when using <a href="../stripe.html">Stripe.js</a> (<strong>required</strong> for all applications), you'll need to provide the <code>stripe_publishable_key</code> returned in the OAuth response, not your own publishable key.</p>

<p>Any token generated by a publishable key will only be usable by that account&mdash;that is, you won't be able to make a charge using a token created by someone else's publishable key. The only exception to this rule is if you're <a href="shared-customers.html">sharing customers</a>.</p>

<hr />

<h1 id="sample-code">Sample OAuth Applications</h1>

<p>Here's some sample code, but we recommend that you use a <a href="http://oauth.net/2/">client library</a> instead of handling the implementation yourself.</p>

<section class="code-example">
<nav class="lang-control">
  <a href="https://stripe.com/docs/connect/.">ruby</a>
  <a href="https://stripe.com/docs/connect/.">python</a>
  <a href="https://stripe.com/docs/connect/.">php</a>
  <a href="https://stripe.com/docs/connect/.">node</a>
</nav><div class="terminal-wrap" data-action="tutorial_oauth">
  <pre><code><div class="terminal"></div></code></pre>
</div>
</section>

</article>

<footer>
<section id="next">
<h1>Next steps</h1>

Read the full <a href="reference.html">reference documentation</a> for Stripe Connect.
</section>

<section id="questions">
<h1>Questions?</h1>
<p>We're always happy to help with code or other questions you might have! Check out our answers to <a href="https://support.stripe.com/">common questions</a> or chat live with other developers in #stripe on freenode.</p>

</section>
</footer>

</section>


    </section>

  </section><!-- #documentation -->

  <div id="footer">
    <div class="country-dropdown-view">
        <a class="select">
            <span>
                <img src="../../img/flags/us.png" width="23" height="17" data-hires="true" />
                <strong>United States</strong>
            </span>
        </a>

        <div class="popover">
            <div class="arrow"></div>
            <h4>Select your Country</h4>
            <ul>
                    <li>
                        <a href="https://stripe.com/country?country=AU&amp;redirect=/docs/connect/oauth" >
                            <img src="../../img/flags/au.png" width="23" height="17" data-hires="true" />
                            <span>Australia</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=CA&amp;redirect=/docs/connect/oauth" >
                            <img src="../../img/flags/ca.png" width="23" height="17" data-hires="true" />
                            <span>Canada</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=GB&amp;redirect=/docs/connect/oauth" >
                            <img src="../../img/flags/gb.png" width="23" height="17" data-hires="true" />
                            <span>United Kingdom</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=IE&amp;redirect=/docs/connect/oauth" >
                            <img src="../../img/flags/ie.png" width="23" height="17" data-hires="true" />
                            <span>Ireland</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=US&amp;redirect=/docs/connect/oauth" class="selected">
                            <img src="../../img/flags/us.png" width="23" height="17" data-hires="true" />
                            <span>United States</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=AT&amp;redirect=/docs/connect/oauth" >
                            <img src="../../img/flags/at.png" width="23" height="17" data-hires="true" />
                            <span>Austria</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=BE&amp;redirect=/docs/connect/oauth" >
                            <img src="../../img/flags/be.png" width="23" height="17" data-hires="true" />
                            <span>Belgium</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=DK&amp;redirect=/docs/connect/oauth" >
                            <img src="../../img/flags/dk.png" width="23" height="17" data-hires="true" />
                            <span>Denmark</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=FI&amp;redirect=/docs/connect/oauth" >
                            <img src="../../img/flags/fi.png" width="23" height="17" data-hires="true" />
                            <span>Finland</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=FR&amp;redirect=/docs/connect/oauth" >
                            <img src="../../img/flags/fr.png" width="23" height="17" data-hires="true" />
                            <span>France</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=DE&amp;redirect=/docs/connect/oauth" >
                            <img src="../../img/flags/de.png" width="23" height="17" data-hires="true" />
                            <span>Germany</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=IT&amp;redirect=/docs/connect/oauth" >
                            <img src="../../img/flags/it.png" width="23" height="17" data-hires="true" />
                            <span>Italy</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=LU&amp;redirect=/docs/connect/oauth" >
                            <img src="../../img/flags/lu.png" width="23" height="17" data-hires="true" />
                            <span>Luxembourg</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=NL&amp;redirect=/docs/connect/oauth" >
                            <img src="../../img/flags/nl.png" width="23" height="17" data-hires="true" />
                            <span>Netherlands</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=NO&amp;redirect=/docs/connect/oauth" >
                            <img src="../../img/flags/no.png" width="23" height="17" data-hires="true" />
                            <span>Norway</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=ES&amp;redirect=/docs/connect/oauth" >
                            <img src="../../img/flags/es.png" width="23" height="17" data-hires="true" />
                            <span>Spain</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=SE&amp;redirect=/docs/connect/oauth" >
                            <img src="../../img/flags/se.png" width="23" height="17" data-hires="true" />
                            <span>Sweden</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=CH&amp;redirect=/docs/connect/oauth" >
                            <img src="../../img/flags/ch.png" width="23" height="17" data-hires="true" />
                            <span>Switzerland</span>
                        </a>
                    </li>
          </ul>
        </div>
    </div>


    <p><a href="https://stripe.com/">&copy; Stripe</a></p>

    <ul>
        <li><a href="https://status.stripe.com/"><span>System Status</span></a></li>
        <li><a href="https://stripe.com/about">About</a></li>
        <li><a href="https://stripe.com/blog"><span>Blog</span></a></li>
        <li><a href="https://stripe.com/jobs"><span>Jobs</span></a></li>
        <li><a href="http://twitter.com/stripe">Twitter</a></li>
    </ul>
    <ul class="lesser">
        <li><a href="https://stripe.com/terms">Terms of Service</a></li>
        <li><a href="https://stripe.com/privacy">Privacy Policy</a></li>
    </ul>
</div>
<div class="country-dropdown-overlay"></div>

    <script src="../../assets/jquery-47d53801b9f61ca8a21dcc2571aeb3ec.js"></script>
    <script src="../../assets/shared-3abadcaa3af6e785a085062e45894014.js"></script>

<script src="../../assets/footer_analytics-6e8fc3677422b1ab0ef7aca057103605.js"></script>

<noscript>
  <div style="display:inline;">
  <img height="1" width="1" style="border-style:none;" alt="" src="https://googleads.g.doubleclick.net/pagead/viewthroughconversion/1008370075/?value=0&amp;guid=ON&amp;script=0"/>
  </div>
</noscript>


    <script src="../../assets/tutorial-157e244e708a25090e620c16535e5350.js"></script>
  <script type="text/javascript">
      var APIValues = {};
          APIValues["ruby"] = {};
              APIValues["ruby"]["tutorial_connect_api_key"] = "\u003Cspan class=\"highlight_js ruby\"\u003E# Not recommended: setting global API key state\nStripe.api_key = ACCESS_TOKEN\nStripe::Customer.create(\n  :description =\u0026gt; \u0026quot;example@stripe.com\u0026quot;\n)\n\n# Recommended: sending API key with every request\nStripe::Customer.create(\n  {:description =\u0026gt; \u0026quot;example@stripe.com\u0026quot;},\n  ACCESS_TOKEN # user\u0026#39;s access token from the Stripe Connect flow\n)\u003C/span\u003E";
              APIValues["ruby"]["tutorial_oauth"] = "\u003Cspan class=\"highlight_js ruby\"\u003E# See full code example here: https://gist.github.com/2314782\n\n# Using OAuth2 gem by Intridea (https://github.com/intridea/oauth2).\n\n# Additionally, check out this OmniAuth Stripe Connect gem:\n# https://github.com/isaacsanders/omniauth-stripe-connect\n\nconfigure do\n  config = YAML::load(File.open(\u0026#39;config.yml\u0026#39;))\n\n  set :api_key, config[\u0026#39;api_key\u0026#39;]\n  set :client_id, config[\u0026#39;client_id\u0026#39;]\n\n  options = {\n    :site =\u0026gt; \u0026#39;https://connect.stripe.com\u0026#39;,\n    :authorize_url =\u0026gt; \u0026#39;/oauth/authorize\u0026#39;,\n    :token_url =\u0026gt; \u0026#39;/oauth/token\u0026#39;\n  }\n\n  set :client, OAuth2::Client.new(settings.client_id, settings.api_key, options)\nend\n\nget \u0026#39;/authorize\u0026#39; do\n  params = {\n    :scope =\u0026gt; \u0026#39;read_write\u0026#39;\n  }\n\n  # Redirect the user to the authorize_uri endpoint\n  url = settings.client.auth_code.authorize_url(params)\n  redirect url\nend\n\nget \u0026#39;/oauth/callback\u0026#39; do\n  # Pull the authorization_code out of the response\n  code = params[:code]\n\n  # Make a request to the access_token_uri endpoint to get an access_token\n  @resp = settings.client.auth_code.get_token(code, :params =\u0026gt; {:scope =\u0026gt; \u0026#39;read_write\u0026#39;})\n  @access_token = @resp.token\n\n  # Use the access_token as you would a regular live-mode API key\n  # TODO: Stripe logic\n\n  erb :callback\nend\u003C/span\u003E";
          APIValues["python"] = {};
              APIValues["python"]["tutorial_connect_api_key"] = "\u003Cspan class=\"highlight_js python\"\u003E# Not recommended: setting global API key state\nstripe.api_key = ACCESS_TOKEN\nstripe.Customer.create(\n  description=\u0026quot;example@stripe.com\u0026quot;\n)\n\n# Recommended: sending API key with every request\nstripe.Customer.create(\n  description=\u0026quot;example@stripe.com\u0026quot;,\n  api_key=ACCESS_TOKEN # user\u0026#39;s access token from the Stripe Connect flow\n)\u003C/span\u003E";
              APIValues["python"]["tutorial_oauth"] = "\u003Cspan class=\"highlight_js python\"\u003E# See full code example here: https://gist.github.com/3517668\n\n@app.route(\u0026#39;/authorize\u0026#39;)\ndef authorize:\n  site   = app.config[\u0026#39;SITE\u0026#39;] + app.config[\u0026#39;AUTHORIZE_URI\u0026#39;]\n  params = {\u0026#39;response_type\u0026#39;: \u0026#39;code\u0026#39;,\n            \u0026#39;scope\u0026#39;: \u0026#39;read_write\u0026#39;,\n            \u0026#39;client_id\u0026#39;: app.config[\u0026#39;CLIENT_ID\u0026#39;]\n           }\n\n  # Redirect to Stripe /oauth/authorize endpoint\n  url = site + \u0026#39;?\u0026#39; + urllib.urlencode(params)\n  return redirect(url)\n\n@app.route(\u0026#39;/oauth/callback\u0026#39;)\ndef callback:\n  code   = request.args.get(\u0026#39;code\u0026#39;)\n  data   = {\u0026#39;grant_type\u0026#39;: \u0026#39;authorization_code\u0026#39;,\n            \u0026#39;client_id\u0026#39;: app.config[\u0026#39;CLIENT_ID\u0026#39;],\n            \u0026#39;client_secret\u0026#39;: app.config[\u0026#39;API_KEY\u0026#39;]\n            \u0026#39;code\u0026#39;: code\n           }\n\n  # Make /oauth/token endpoint POST request\n  url = app.config[\u0026#39;SITE\u0026#39;] + app.config[\u0026#39;TOKEN_URI\u0026#39;]\n  resp = requests.post(url, params=data)\n\n  # Grab access_token (use this as your user\u0026#39;s API key)\n  token = resp.json.get(\u0026#39;access_token\u0026#39;)\n  return render_template(\u0026#39;callback.html\u0026#39;, token=token)\u003C/span\u003E";
          APIValues["php"] = {};
              APIValues["php"]["tutorial_connect_api_key"] = "\u003Cspan class=\"highlight_js php\"\u003E// Not recommended: setting global API key state\nStripe::setApiKey(ACCESS_TOKEN);\nStripe_Customer::create(\n  array(\u0026quot;description\u0026quot; =\u0026gt; \u0026quot;example@stripe.com\u0026quot;)\n);\n\n// Recommended: sending API key with every request\nStripe_Customer::create(\n  array(\u0026quot;description\u0026quot; =\u0026gt; \u0026quot;example@stripe.com\u0026quot;),\n  ACCESS_TOKEN // user\u0026#39;s access token from the Stripe Connect flow\n);\u003C/span\u003E";
              APIValues["php"]["tutorial_oauth"] = "\u003Cspan class=\"highlight_js php\"\u003E// See full code example here: https://gist.github.com/3507366\n\nif (isset($_GET[\u0026#39;code\u0026#39;])) { // Redirect w/ code\n  $code = $_GET[\u0026#39;code\u0026#39;];\n\n  $token_request_body = array(\n    \u0026#39;grant_type\u0026#39; =\u0026gt; \u0026#39;authorization_code\u0026#39;,\n    \u0026#39;client_id\u0026#39; =\u0026gt; \u0026#39;ca_32D88BD1qLklliziD7gYQvctJIhWBSQ7\u0026#39;,\n    \u0026#39;code\u0026#39; =\u0026gt; $code,\n    \u0026#39;client_secret\u0026#39; =\u0026gt; \u0026#39;sk_test_BQokikJOvBiI2HlWgH4olfQ2\u0026#39;\n  );\n\n  $req = curl_init(TOKEN_URI);\n  curl_setopt($req, CURLOPT_RETURNTRANSFER, true);\n  curl_setopt($req, CURLOPT_POST, true );\n  curl_setopt($req, CURLOPT_POSTFIELDS, http_build_query($token_request_body));\n\n  // TODO: Additional error handling\n  $respCode = curl_getinfo($req, CURLINFO_HTTP_CODE);\n  $resp = json_decode(curl_exec($req), true);\n  curl_close($req);\n\n  echo $resp[\u0026#39;access_token\u0026#39;];\n} else if (isset($_GET[\u0026#39;error\u0026#39;])) { // Error\n  echo $_GET[\u0026#39;error_description\u0026#39;];\n} else { // Show OAuth link\n  $authorize_request_body = array(\n    \u0026#39;response_type\u0026#39; =\u0026gt; \u0026#39;code\u0026#39;,\n    \u0026#39;scope\u0026#39; =\u0026gt; \u0026#39;read_write\u0026#39;,\n    \u0026#39;client_id\u0026#39; =\u0026gt; \u0026#39;ca_32D88BD1qLklliziD7gYQvctJIhWBSQ7\u0026#39;\n  );\n\n  $url = AUTHORIZE_URI . \u0026#39;?\u0026#39; . http_build_query($authorize_request_body);\n  echo \u0026quot;\u0026lt;a href=\u0026#39;$url\u0026#39;\u0026gt;Connect with Stripe\u0026lt;/a\u0026gt;\u0026quot;;\n}\u003C/span\u003E";
          APIValues["node"] = {};
              APIValues["node"]["tutorial_connect_api_key"] = "\u003Cspan class=\"highlight_js javascript\"\u003E// Not recommended: setting global API key state\nvar stripe = require(\u0026#39;stripe\u0026#39;)(ACCESS_TOKEN);\nstripe.customers.create({\n  description: \u0026quot;example@stripe.com\u0026quot;\n});\n\n// Recommended: sending API key with every request\nstripe.customers.create(\n  { description: \u0026quot;example@stripe.com\u0026quot; },\n  ACCESS_TOKEN // user\u0026#39;s access token from the Stripe Connect flow\n);\u003C/span\u003E";
              APIValues["node"]["tutorial_oauth"] = "\u003Cspan class=\"highlight_js javascript\"\u003E// See full code example here: https://gist.github.com/7109113\n\napp.get(\u0026quot;/authorize\u0026quot;, function(req, res) {\n  // Redirect to Stripe /oauth/authorize endpoint\n  res.redirect(AUTHORIZE_URI + \u0026quot;?\u0026quot; + qs.stringify({\n    response_type: \u0026quot;code\u0026quot;,\n    scope: \u0026quot;read_write\u0026quot;,\n    client_id: CLIENT_ID\n  }));\n});\n\napp.get(\u0026quot;/oauth/callback\u0026quot;, function(req, res) {\n\n  var code = req.query.code;\n\n  // Make /oauth/token endpoint POST request\n  request.post({\n    url: TOKEN_URI,\n    form: {\n      grant_type: \u0026quot;authorization_code\u0026quot;,\n      client_id: CLIENT_ID,\n      code: code,\n      client_secret: API_KEY\n    }\n  }, function(err, r, body) {\n\n    var accessToken = JSON.parse(body).access_token;\n\n    // Do something with your accessToken\n\n    // For demo\u0026quot;s sake, output in response:\n    res.send({ \u0026quot;Your Token\u0026quot;: accessToken });\n\n  });\n});\u003C/span\u003E";
  </script>


  <script src="../../assets/documentation-6a120856de81b5511bf1790365f19166.js"></script>
  <script src="../../assets/highlight.pack-8bd9d9dd93b5ef1f95e855d7641494d2.js"></script>
<script src="../../assets/highlighter-1268244f129b69592ca48d0f0f198cac.js"></script>

  <script type="text/javascript">
    Analytics.page("docs");
  </script>
</body>

<!-- Mirrored from stripe.com/docs/connect/oauth by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 09 Feb 2015 07:33:13 GMT -->
</html>
