<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from stripe.com/docs/mobile/ios by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 09 Feb 2015 07:33:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>iOS Integration</title>
    <link rel="stylesheet" type="text/css" href="../../assets/site-ea99019a1bc27872a48d1149a4785b01.css" media="screen" />
    <script type="text/javascript">
        var _sf_startpt=(new Date()).getTime()
        var APIValues = {};
    </script>
    <script type="application/json" id="mixpanel_config">{&quot;identifier&quot;:&quot;eb71b6171a4f7ed97de9b7a0395b7ca5&quot;}</script>
<script type="application/json" id="analytics_config">{}</script>
<script src="../../../www.googleadservices.com/pagead/f.txt"></script>
<script src="../../assets/external_analytics-a9e3d39cd6110aa8c184d9c1f2e5777e.js"></script>
<script src="../../assets/qframe-cb903dc9166e266dc7d9f11d44f5e81a.js"></script>

    <link rel="shortcut icon" href="https://stripe.com/favicon.ico">

    <!--[if lt IE 9]>
    <script src="/assets/html5shiv-17761200a17ebcb716dda86cca6d2472.js"></script>
    <![endif]-->
    <script type="text/javascript" src="../../../use.typekit.net/gbh7uto.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    
</head>
<body id="documentation">

  <div id="header">
    <h1><a href="https://stripe.com/">Stripe</a></h1>
    <div class="navigation">
    <div class="signin"><a id='signin' href="https://dashboard.stripe.com/login"><span>Sign In</span></a></div>

  <ul class="global">
    <li><a href="https://stripe.com/docs">Documentation</a></li>
    <li><a href="https://support.stripe.com/">Help &amp; Support</a></li>
  </ul>
</div>

  </div><!-- #header -->

  <section id="doc">

    <nav>

      <h1 class="getting-started">Documentation</h1>
      <ul>
        <li class="unselected">
          <a href="https://stripe.com/docs">Getting Started</a>
        </li>
          <li class="unselected sub">
            <a href="../tutorials/checkout.html">Embedded Form</a>
          </li>
          <li class="unselected sub">
            <a href="../tutorials/forms.html">Custom Forms</a>
          </li>
          <li class="unselected sub">
            <a href="../mobile.html">Mobile Apps</a>
          </li>

        <li class="unselected">
          <a href="../tutorials/charges.html">Charging Cards</a>
        </li>

        <li class="unselected">
          <a href="../tutorials/sending-transfers.html">Sending Transfers</a>
        </li>

        <li class="unselected">
          <a href="../tutorials/dashboard.html">Your Account</a>
        </li>
      </ul>

      <h1 class="references">References</h1>
      <ul>
        <li class="unselected">
          <a href="../stripe.html">Stripe.js</a>
        </li>
        <li class="unselected">
          <a href="../checkout.html">Checkout</a>
        </li>
        <li class="unselected">
          <a href="../webhooks.html">Webhooks</a>
        </li>
        <li class="unselected">
          <a href="../fraud.html">Fraud Protection</a>
        </li>
        <li class="unselected">
          <a href="../testing.html">Testing</a>
        </li>
        <li class="unselected">
          <a href="../examples.html">Examples</a>
        </li>
        <li class="unselected">
          <a href="../upgrades.html">API Upgrades</a>
        </li>
        <li class="unselected">
          <a href="../libraries.html">API Libraries</a>
        </li>
        <li class="unselected">
          <a href="../guides/file-upload.html">File Upload Guide</a>
        </li>
        <li class="unselected">
          <a href="../api.html" class="external" target="_blank">
            Full API Reference
          </a>
        </li>
      </ul>

      <h1 class="subscriptions">Subscriptions</h1>
      <ul>
        <li class="unselected">
          <a href="../subscriptions.html">Overview</a>
        </li>
        <li class="unselected">
          <a href="../tutorials/subscriptions.html">Getting Started</a>
        </li>
        <li class="unselected">
          <a href="../guides/subscriptions.html">Integration Guide</a>
        </li>
      </ul>

      <h1 class="connect">Connect</h1>
      <ul>
        <li class="unselected">
          <a href="../connect.html">Overview</a>
        </li>
        <li class="unselected">
          <a href="../connect/getting-started.html">Getting Started</a>
        </li>
        <li class="unselected">
          <a href="../connect/oauth.html">Integrating OAuth</a>
        </li>
        <li class="unselected">
          <a href="../connect/collecting-fees.html">Collecting Fees</a>
        </li>
        <li class="unselected">
          <a href="../connect/shared-customers.html">Shared Customers</a>
        </li>
        <li class="unselected">
          <a href="../connect/reference.html">Reference</a>
        </li>
      </ul>

      <h1 class="disputes">Disputes</h1>
      <ul>
        <li class="unselected">
          <a href="https://stripe.com/help/disputes-overview">Overview</a>
        </li>
        <li class="unselected">
          <a href="../guides/dispute-evidence.html">Submitting Evidence</a>
        </li>
        <li class="unselected">
          <a href="https://stripe.com/help/dispute-types">Dispute Types</a>
        </li>
        <li class="unselected">
          <a href="https://stripe.com/help/disputes">FAQ</a>
        </li>
      </ul>


      <h1 class="faq"><abbr title="Frequently Asked Questions">FAQ</abbr></h1>
      <ul>
        <li class="unselected">
          <a href="https://stripe.com/help/transfers">Getting Paid</a>
        </li>
        <li class="unselected">
          <a href="https://stripe.com/help/ssl">SSL/TLS</a>
        </li>
        <li class="unselected">
          <a href="https://stripe.com/help/security">Security</a>
        </li>
      </ul>

      <h1 class="more">More</h1>
      <ul>
        <li class="unselected">
          <a href="https://stripe.com/help/contact">Contact</a>
        </li>
        <li class="unselected">
          <a href="https://stripe.com/global">Global Users</a>
        </li>
        <li class="unselected">
          <a href="https://stripe.com/gallery">Gallery</a>
        </li>
        <li class="last unselected">
          <a href="../integrations.html">Integrations</a>
        </li>
      </ul>

    </nav>

    <section id="content">
      <style>
  div.screenshots {
    padding: 0px 0px 20px 0;
  }

  div.screenshots img {
    display: block;
  }
</style>

<section id="details">
  <header>
    <h1>iOS Integration</h1>
    <p>
      Accept payments in iPhone and iPad apps, with built-in support for Apple Pay.
    </p>
  </header>

  <article>
    <aside class="content note">
      <h1>Apple Pay vs. In-App Purchases</h1>
      <p>Apple Pay doesnâ€™t replace In-App Purchases. You should use Apple Pay when charging for physical goods (such as groceries, clothing, and appliances) or for services (such as club memberships, hotel reservations, and tickets for events).</p>
      <p>You should continue to use In-App Purchases to charge for virtual goods such as premium content in your app.</p>
      <p><a href="https://support.stripe.com/questions/apple-and-stripe-tos-and-fees">Learn more</a>.</p>
    </aside>   
    <p>
      If you want to build a mobile app like <a href="http://lyft.me/">Lyft</a> or <a href="http://www.fancy.com/">Fancy</a> and enable people to make purchases directly in your app, our iOS libraries can help. The library also supports <a href="https://stripe.com/blog/apple-pay/">Apple Pay</a> so that your users can make frictionless payments without having to enter in their credit card info.
    </p>   
    <p>
      Accepting payments in your app involves 3 steps, which we'll cover in this guide:
    </p>
    <ol>
      <li><a href="#collecting-card-information" class="arrow">Collecting credit card information from your customer</a></li>
      <li><a href="#creating-tokens" class="arrow">Converting the credit card information to a single-use token</a></li>
      <li><a href="#sending-tokens" class="arrow">Sending this token to your server to create a charge</a></li>
    </ol>

    <h1 id="setup">Getting Started</h1>
    <h2 id="installation">Step 1: Install the library</h2>

    <h3>Using CocoaPods</h3>

    <p>We recommend using CocoaPods to
      install the <a href="https://github.com/stripe/stripe-ios">Stripe iOS library</a>, since it makes it easy to keep your app's dependencies up to date.
    </p>

    <p>
      If you haven't set up Cocoapods before, their <a href="http://cocoapods.org/">site</a> has installation instructions.
      Then, add <code>pod 'Stripe'</code> to your <code>Podfile</code>, and run <code>pod install</code>.
    </p>

    <p>
      (Don't forget to use the <code>.xcworkspace</code> file to open your
      project in Xcode, instead of the <code>.xcodeproj</code> file, from here on
      out.)
    </p>

    <h3>Using git</h3>

    <p>
      Alternatively, you can simply clone the iOS library repository directly:
    </p>

    <section class="code-example">
      <div class="terminal-wrap">
        <pre><code>git clone https://github.com/stripe/stripe-ios.git</code></pre>
      </div>
    </section>

  </p>

  <p>
    Then add the Stripe library to your Xcode project:
  </p>
  <ol>
    <li>In the menubar, click on 'File' then 'Add files to "Project"...'.</li>
    <li>Select the 'Stripe' directory in the downloaded repository.</li>
    <li>Make sure 'Copy items into destination group's folder (if needed)' is checked.</li>
    <li>Click 'Add'.</li>
    <li>In your project settings, go to the "Build Phases" tab, and make sure <code>Foundation.framework</code>, <code>Security.framework</code>, and <code>PassKit.framework</code> are included in the "Link Binary With Libraries" section. If you're targeting versions of iOS before iOS8, make sure <code>PassKit.framework</code> is listed as "Optional."</li>
  </ol>

  <h2>Step 2: Configure API keys</h2>

  <p>First, you'll want to configure Stripe with your <a href="https://dashboard.stripe.com/account/apikeys">publishable API key</a>. We recommend doing this in your <code>AppDelegate</code>'s <code><a href="http://developer.apple.com/library/ios/documentation/uikit/reference/uiapplicationdelegate_protocol/Reference/Reference.html#//apple_ref/doc/uid/TP40006786-CH3-SW18">-application:didFinishLaunchingWithOptions:</a></code> method so that it'll be set for the entire lifecycle of your app.</p>
  <section class="code-example">
    <div class="terminal-wrap">
      <pre><code><span class="highlight_js c">// AppDelegate.m

#import &quot;AppDelegate.h&quot;
#import &quot;Stripe.h&quot;

NSString * const StripePublishableKey = @&quot;pk_test_6pRNASCoBOKtIshFeQd4XMUh&quot;;

@implementation AppDelegate

- (BOOL)application:(UIApplication *)application
didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
  [Stripe setDefaultPublishableKey:StripePublishableKey];
  return YES;
}

@end</span></code></pre>
      </div></section>

      <p>
        We've placed your <strong>test publishable</strong> API key as the <code>StripePublishableKey</code> constant in the above snippet. You'll need to swap it out with your <strong>live publishable</strong> key in production. You can see all your API keys in <a href="https://dashboard.stripe.com/#account/apikeys">your dashboard</a>.
      </p>

      <h1 id="collecting-card-information">Collecting credit card information</h1>

      <aside class="content note">
        <h1>Test Mode</h1>
        <p>When you're using your test publishable key, our libraries give you the ability to test your payment flow without having to charge real credit cards.
          <p>
            On iOS8+, you can use our <a href="https://github.com/stripe/ApplePayStubs">ApplePayStubs</a> library to simulate the Apple Pay flow with test credit cards.
          </p>
          <p>
            If you're building your own form or using PaymentKit, using the card number <code>4242424242424242</code> (along with any CVC and
            future expiration date) will accomplish the same effect.
          </p>
          <p>You can learn more in our <a href="../testing.html">testing documentation.</a></p>
        </p>
      </aside>

      <p>At some point in the flow of your app, you'll want to obtain payment details from the user. There are three ways to do this. You can (in increasing order of complexity):</p>
      <ol>
        <li><a href="#applepay">Use Apple Pay framework to access your users' stored payment information<span class="arrow"></span></a></li>
        <li><a href="#paymentkit">Use our pre-built form component, PaymentKit, to collect new credit card details<span class="arrow"></span></a></li>
        <li><a href="#custom-form">Build your own credit card form from scratch<span class="arrow"></span></a></li>
      </ol>

      <p>
        <a href="http://developer.apple.com/apple-pay/">Apple Pay</a> only supports certain US credit cards on the latest iOS devices. We recommend using Apple Pay in combination with option 2 or option 3 as a fallback on devices where Apple Pay is not available.
      </p>


      <h2 id="applepay">Using Apple Pay</h2>
      <p>
        With Apple Pay, you'll be able to access payment information stored on your customers' iOS devices.
      </p>

      <h3>Important note before starting</h3>
      <p>
        In order to use Apple Pay, you'll need to add the "Apple Pay" capability to your app in Xcode. This requires creating a merchant ID with Apple first, as explained in <a href="apple-pay.html">this tutorial</a>.
      </p>

      <p>
        If you submit your app with Apple Pay code in it, but don't have the "Apple Pay" capability, Apple will send you a warning email. (They'll still accept your submission, though).
        To avoid triggering this warning unnecessarily, after installing our iOS library, you'll need to opt-in in order to use our Apple Pay components.
      </p>

      <p>You'll first need to add <code>STRIPE_ENABLE_APPLEPAY</code> to your app's build settings under "Preprocessor Macros." Next, if you're using Cocoapods, add <code>pod 'Stripe/ApplePay'</code> right below <code>pod 'Stripe'</code> and run <code>pod update</code> then <code>pod install</code>.</p>
      
      <p>
        After you're setup, to use Apple Pay, you'll need to generate a <code>PKPaymentRequest</code> to submit to Apple. We've provided a convenience method to generate one with reasonable defaults. You'll need to set the <code>paymentSummaryItems</code> property to an <code>NSArray</code> of <code>PKPaymentSummaryItem</code>s. These are analogous to line items on a receipt and are used to explain your charge to the user. For a more in-depth reference, see the <a href="http://developer.apple.com/library/ios/documentation/PassKit/Reference/PKPaymentRequest_Ref/index.html">PKPaymentRequest documentation</a>.
      </p>

      <p>
        After you create the request, query the device to see if Apple Pay is available (i.e. if your app is running on the latest hardware and the user has added a valid credit card):
      </p>
      <section class="code-example">
        <div class="terminal-wrap">
          <pre><code><span class="highlight_js c">// ViewController.m

PKPaymentRequest *request = [Stripe
                             paymentRequestWithMerchantIdentifier:YOUR_APPLE_MERCHANT_ID];
// Configure your request here.
NSString *label = @&quot;Premium Llama Food&quot;;
NSDecimalNumber *amount = [NSDecimalNumber decimalNumberWithString:@&quot;10.00&quot;];
request.paymentSummaryItems = @[
  [PKPaymentSummaryItem summaryItemWithLabel:label 
                                      amount:amount];
];

if ([Stripe canSubmitPaymentRequest:request]) {
  ...
} else {
  // Show the user your own credit card form (see options 2 or 3)
}</span>
          </code></pre>
        </div>
      </section>
      <p>
        <code>YOUR_MERCHANT_ID</code> is an identifier that you obtain directly from Appleâ€”log in to your account to do so. Next, you should create and display the payment request view controller.
      </p>
      <p>
        Apple Pay doesn't fully work in the iOS simulator. To that end, we've released a library called <a href="https://github.com/stripe/ApplePayStubs">ApplePayStubs</a> that will help you build, test, and debug your Apple Pay flow without a device. The <code>STPTestPaymentAuthorizationViewController</code> class it defines exposes the same API as <code>PKPaymentAuthorizationViewController</code> but returns test cards. Here, when our app is building in the debug configuration, we'll show that instead.
      </p>
      <p>
        If you'd like to use ApplePayStubs, you can read the installation guide <a href="https://github.com/stripe/ApplePayStubs#installation">here</a>.
      </p>
      <section class="code-example">
        <div class="terminal-wrap">
          <pre><code><span class="highlight_js c">// ViewController.m

if ([Stripe canSubmitPaymentRequest:request]) {
  UIViewController *paymentController;
#if DEBUG
  paymentController = [[STPTestPaymentAuthorizationViewController alloc]
                         initWithPaymentRequest:paymentRequest];
  paymentController.delegate = self;
#else
  paymentController = [[PKPaymentAuthorizationViewController alloc]
                         initWithPaymentRequest:paymentRequest];
  paymentController.delegate = self;
#end
  [self presentViewController:paymentController animated:YES completion:nil];
} else {
  // Show the user your own credit card form (see options 2 or 3)
}</span>
          </code></pre>
        </div>
      </section>
      <p>
      You may have noticed that <code>paymentControllerWithRequest:delegate:</code> needs to be given a <code>PKPaymentAuthorizationViewControllerDelegate</code>. You'll handle the <code>PKPayment</code> that the controller returns by implementing this protocol. In this case, we'll implement it in our <code>ViewController</code>:
      </p>
      <section class="code-example">
        <div class="terminal-wrap">
          <pre><code><span class="highlight_js c">// ViewController.m

- (void)paymentAuthorizationViewController:(PKPaymentAuthorizationViewController *)controller
                       didAuthorizePayment:(PKPayment *)payment
                                completion:(void (^)(PKPaymentAuthorizationStatus))completion {
    /*
    We&#39;ll implement this method below in &#39;Creating a single-use token&#39;.
    Note that we&#39;ve also been given a block that takes a
    PKPaymentAuthorizationStatus. We&#39;ll call this function with either
    PKPaymentAuthorizationStatusSuccess or PKPaymentAuthorizationStatusFailure
    after all of our asynchronous code is finished executing. This is how the
    PKPaymentAuthorizationViewController knows when and how to update its UI.
    */
    [self handlePaymentAuthorizationWithPayment:payment completion:completion];
}

- (void)paymentAuthorizationViewControllerDidFinish:(PKPaymentAuthorizationViewController *)controller {
    [self dismissViewControllerAnimated:YES completion:nil];
}</span>
          </code></pre>
        </div>
      </section>
      <p>You can also choose to implement some optional <code>PKPaymentAuthorizationViewControllerDelegate</code> methods for custom events (for example, to recalculate shipping costs based on user selection). See the <a href="http://developer.apple.com/library/ios/documentation/PassKit/Reference/PKPaymentAuthorizationViewController_Ref/index.html">PKPaymentAuthorizationViewController documentation</a> for more information about these callbacks.</p>

      <p>After the controller has returned with a <code>PKPayment</code>, we can move ahead to <a href="#pkpayment-token">the next step</a>.</p>

      <h2 id="paymentkit">Using PaymentKit</h2>

      <p>First, we'll need to add <a href="https://github.com/stripe/PaymentKit">PaymentKit</a> to your project. Doing this is similar to <a href="#installation">installing stripe-ios</a>: You can either add <code>pod 'PaymentKit'</code> to your Podfile (don't forget to re-run <code>pod install</code> afterwards), or clone <a href="https://github.com/stripe/paymentkit.git">the repository</a> and add it to your project as above.</p>

      <p>Next, let's create a class called <code>PaymentViewController</code> inheriting from <code>UIViewController</code>. Open PaymentViewController.m, create a weak<code>PTKView</code> property in its class-continuation category, and declare the PaymentViewController as its <code>PTKViewDelegate</code>.</p>

      <section class="code-example">
        <div class="terminal-wrap">
          <pre><code><span class="highlight_js c">// PaymentViewController.m

#import &quot;PaymentViewController.h&quot;
#import &quot;PTKView.h&quot;

@interface PaymentViewController ()&lt;PTKViewDelegate&gt;
@property(weak, nonatomic) PTKView *paymentView;
@end</span></code>
          </pre>
        </div>
      </section>

      <p>
        Next, let's instantiate the <code>PTKView</code> and append it as a subview.
      </p>

      <section class="code-example">
        <div class="terminal-wrap">
          <pre><code><span class="highlight_js c">// PaymentViewController.m

- (void)viewDidLoad
{
  [super viewDidLoad];
  PTKView *view = [[PTKView alloc] initWithFrame:CGRectMake(15,20,290,55)];
  self.paymentView = view;
  self.paymentView.delegate = self;
  [self.view addSubview:self.paymentView];
}</span></code></pre>
          </div>
        </section>

        <p>This will add a PTKView to the controller to accept card numbers, dates, CVCs, and zip codes. It'll format the input, and validate it on the fly.</p>

        <p>
          When all the card data is added and valid the <code>stripeView:withCard:isValid:</code> delegate method will be called. In the callback, for example, we could enable a save button that allows users to submit their valid cards:
        </p>

        <section class="code-example">
          <div class="terminal-wrap">
            <pre><code><span class="highlight_js c">- (void)paymentView:(PTKView *)view withCard:(PTKCard *)card isValid:(BOOL)valid
{
  // Toggle navigation, for example
  self.saveButton.enabled = valid;
}</span></code></pre>
            </div>
          </section>

          <h2 id="custom-form">Building your own form</h2>
          <p>If you build your own payment form, you'll need to collect at least your customers' card numbers and expiration dates. You should likely also collect the CVC to prevent fraud. You can also optionally collect the user's name and billing address for addititional fraud protection.</p>

          <h1 id="creating-tokens">Creating Tokens</h1>

          <p>
            Our libraries shoulder the burden of PCI compliance by helping you avoid the need to send card data directly to your server. Instead, our libraries send credit card data directly to our servers, where we can convert them to <a href="../api.html#tokens">tokens</a>. You can charge these tokens later in your server-side code.
          </p>

          <h2 id="pkpayment-token">Using a PKPayment (Apple Pay)</h2>
          <p>
          After you've received a <code>PKPayment</code>, you can turn it into a single-use Stripe token with a simple method call:
            <section class="code-example">
              <div class="terminal-wrap">
                <pre><code><span class="highlight_js c">// ViewController.m

- (void)handlePaymentAuthorizationWithPayment:(PKPayment *)payment
                                   completion:(void (^)(PKPaymentAuthorizationStatus))completion {
    [Stripe createTokenWithPayment:payment
            completion:^(STPToken *token, NSError *error) {
                if (error) {
                    completion(PKPaymentAuthorizationStatusFailure);
                    return;
                }
                /*
                We&#39;ll implement this below in &quot;Sending the token to your server&quot;.
                Notice that we&#39;re passing the completion block through.
                See the above comment in didAuthorizePayment to learn why.
                */
                [self createBackendChargeWithToken:token completion:completion];
            }];
}</span></code></pre>
                </div>
              </section>
          </p>

          <h2 id="stpcard-token">Using an STPCard</h2>
          <p>
            If you're using PaymentKit or your own form, you can assemble the data into an <code>STPCard</code>. Once you've collected the card number, expiration, and CVC, package them up in an <code>STPCard</code> object and invoke the <code>createTokenWithCard:</code> method on the <code>Stripe</code> class, instructing the library to send off the credit card data to Stripe and return a token.
          </p>

          <section class="code-example">
            <div class="terminal-wrap">
              <pre><code><span class="highlight_js c">- (IBAction)save:(id)sender {
  STPCard *card = [[STPCard alloc] init];
  card.number = self.paymentView.card.number;
  card.expMonth = self.paymentView.card.expMonth;
  card.expYear = self.paymentView.card.expYear;
  card.cvc = self.paymentView.card.cvc;
  [Stripe createTokenWithCard:card completion:^(STPToken *token, NSError *error) {
    if (error) {
      [self handleError:error];
    } else {
      [self createBackendChargeWithToken:token];
    }
  }];
}</span></code></pre>
              </div>
            </section>

            <p>
              In the example above, we're calling <code>createTokenWithCard:</code> when a save button is tapped. The important thing to ensure is the <code>createToken</code> isn't called before the user has finished inputting their details.
            </p>

            <p>
              Handling error messages and showing activity indicators while we're creating the token is up to you.
            </p>

          <h1 id="sending-tokens">Sending the token to your server</h1>

          <p>
            The block you gave to <code>createToken</code> will be called whenever Stripe returns with a token (or error). You'll need to send the token off to your server so you can, for example, <a href="../tutorials/charges.html">charge the card</a>.
          </p>

          <p>Here's how it looks for a token created with Apple Pay:</p>

          <section class="code-example">
            <div class="terminal-wrap">
              <pre><code><span class="highlight_js c">// ViewController.m

- (void)createBackendChargeWithToken:(STPToken *)token
                          completion:(void (^)(PKPaymentAuthorizationStatus))completion {
  NSURL *url = [NSURL URLWithString:@&quot;https://example.com/token&quot;];
  NSMutableURLRequest *request = [[NSMutableURLRequest alloc] initWithURL:url];
  request.HTTPMethod = @&quot;POST&quot;;
  NSString *body     = [NSString stringWithFormat:@&quot;stripeToken=%@&quot;, token.tokenId];
  request.HTTPBody   = [body dataUsingEncoding:NSUTF8StringEncoding];

  [NSURLConnection sendAsynchronousRequest:request
                                     queue:[NSOperationQueue mainQueue]
                         completionHandler:^(NSURLResponse *response,
                                                    NSData *data,
                                                   NSError *error) {
    if (error) {
      completion(PKPaymentAuthorizationStatusFailure);
    } else {
      completion(PKPaymentAuthorizationStatusSuccess);
    }
  }];
}</span></code></pre>
                   </div>
                 </section>

           <p>If you're not using Apple Pay, the above code would be mostly the same, though you'll want a slightly different signatureâ€”the <code>completion</code> callback shown above is Apple Pay-specific. You would instead want to implement custom error and success handling.</p>

           <p>
            On the server, you just need to implement an endpoint that will accept a parameter called <code>stripeToken</code>. Make sure any communication with your server is <a href="https://stripe.com/help/ssl">SSL secured</a> to prevent eavesdropping.
          </p>

          <p>
            Once you have a Stripe token representing a card on our server we can go ahead and charge it, save it for charging later, or sign the user up for a subscription.
            For more information, proceed to our <a href="../tutorials/charges.html">creating charges</a> tutorial.
          </p>

          <p>Take a look at the full <a href="https://github.com/stripe/stripe-ios/tree/master/Example">example application</a> to see everything put together.</p>
        </article>

              <footer>
                <section id="next">
                  <h1>Next up</h1>
                  <p>
                    Once you've retrieved a token from Stripe, you're going to want to do something with the
                    payment details you just collected. This is usually one of two things:
                  </p>
                  <ul>
                    <li><a href="../tutorials/charges.html">Charge your user immediately</a></li>
                    <li><a href="../tutorials/subscriptions.html">Create a subscription</a></li>
                  </ul>
                </section>

                <section id="questions">
                  <h1>Questions?</h1>
                  <p>We're always happy to help with code or other questions you might have! Check out our answers to <a href="https://support.stripe.com/">common questions</a> or chat live with other developers in #stripe on freenode.</p>

                </section>
              </footer>
            </section>

    </section>

  </section><!-- #documentation -->

  <div id="footer">
    <div class="country-dropdown-view">
        <a class="select">
            <span>
                <img src="../../img/flags/ch.png" width="23" height="17" data-hires="true" />
                <strong>Switzerland</strong>
            </span>
        </a>

        <div class="popover">
            <div class="arrow"></div>
            <h4>Select your Country</h4>
            <ul>
                    <li>
                        <a href="https://stripe.com/country?country=AU&amp;redirect=/docs/mobile/ios" >
                            <img src="../../img/flags/au.png" width="23" height="17" data-hires="true" />
                            <span>Australia</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=CA&amp;redirect=/docs/mobile/ios" >
                            <img src="../../img/flags/ca.png" width="23" height="17" data-hires="true" />
                            <span>Canada</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=GB&amp;redirect=/docs/mobile/ios" >
                            <img src="../../img/flags/gb.png" width="23" height="17" data-hires="true" />
                            <span>United Kingdom</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=IE&amp;redirect=/docs/mobile/ios" >
                            <img src="../../img/flags/ie.png" width="23" height="17" data-hires="true" />
                            <span>Ireland</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=US&amp;redirect=/docs/mobile/ios" >
                            <img src="../../img/flags/us.png" width="23" height="17" data-hires="true" />
                            <span>United States</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=AT&amp;redirect=/docs/mobile/ios" >
                            <img src="../../img/flags/at.png" width="23" height="17" data-hires="true" />
                            <span>Austria</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=BE&amp;redirect=/docs/mobile/ios" >
                            <img src="../../img/flags/be.png" width="23" height="17" data-hires="true" />
                            <span>Belgium</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=DK&amp;redirect=/docs/mobile/ios" >
                            <img src="../../img/flags/dk.png" width="23" height="17" data-hires="true" />
                            <span>Denmark</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=FI&amp;redirect=/docs/mobile/ios" >
                            <img src="../../img/flags/fi.png" width="23" height="17" data-hires="true" />
                            <span>Finland</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=FR&amp;redirect=/docs/mobile/ios" >
                            <img src="../../img/flags/fr.png" width="23" height="17" data-hires="true" />
                            <span>France</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=DE&amp;redirect=/docs/mobile/ios" >
                            <img src="../../img/flags/de.png" width="23" height="17" data-hires="true" />
                            <span>Germany</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=IT&amp;redirect=/docs/mobile/ios" >
                            <img src="../../img/flags/it.png" width="23" height="17" data-hires="true" />
                            <span>Italy</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=LU&amp;redirect=/docs/mobile/ios" >
                            <img src="../../img/flags/lu.png" width="23" height="17" data-hires="true" />
                            <span>Luxembourg</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=NL&amp;redirect=/docs/mobile/ios" >
                            <img src="../../img/flags/nl.png" width="23" height="17" data-hires="true" />
                            <span>Netherlands</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=NO&amp;redirect=/docs/mobile/ios" >
                            <img src="../../img/flags/no.png" width="23" height="17" data-hires="true" />
                            <span>Norway</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=ES&amp;redirect=/docs/mobile/ios" >
                            <img src="../../img/flags/es.png" width="23" height="17" data-hires="true" />
                            <span>Spain</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=SE&amp;redirect=/docs/mobile/ios" >
                            <img src="../../img/flags/se.png" width="23" height="17" data-hires="true" />
                            <span>Sweden</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://stripe.com/country?country=CH&amp;redirect=/docs/mobile/ios" class="selected">
                            <img src="../../img/flags/ch.png" width="23" height="17" data-hires="true" />
                            <span>Switzerland</span>
                        </a>
                    </li>
          </ul>
        </div>
    </div>


    <p><a href="https://stripe.com/">&copy; Stripe</a></p>

    <ul>
        <li><a href="https://status.stripe.com/"><span>System Status</span></a></li>
        <li><a href="https://stripe.com/about">About</a></li>
        <li><a href="https://stripe.com/blog"><span>Blog</span></a></li>
        <li><a href="https://stripe.com/jobs"><span>Jobs</span></a></li>
        <li><a href="http://twitter.com/stripe">Twitter</a></li>
    </ul>
    <ul class="lesser">
        <li><a href="https://stripe.com/terms">Terms of Service</a></li>
        <li><a href="https://stripe.com/privacy">Privacy Policy</a></li>
    </ul>
</div>
<div class="country-dropdown-overlay"></div>

    <script src="../../assets/jquery-47d53801b9f61ca8a21dcc2571aeb3ec.js"></script>
    <script src="../../assets/shared-3abadcaa3af6e785a085062e45894014.js"></script>

<script src="../../assets/footer_analytics-6e8fc3677422b1ab0ef7aca057103605.js"></script>

<noscript>
  <div style="display:inline;">
  <img height="1" width="1" style="border-style:none;" alt="" src="https://googleads.g.doubleclick.net/pagead/viewthroughconversion/1008370075/?value=0&amp;guid=ON&amp;script=0"/>
  </div>
</noscript>


  

  <script src="../../assets/documentation-6a120856de81b5511bf1790365f19166.js"></script>
  <script src="../../assets/highlight.pack-8bd9d9dd93b5ef1f95e855d7641494d2.js"></script>
<script src="../../assets/highlighter-1268244f129b69592ca48d0f0f198cac.js"></script>

  <script type="text/javascript">
    Analytics.page("docs");
  </script>
</body>

<!-- Mirrored from stripe.com/docs/mobile/ios by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 09 Feb 2015 07:33:13 GMT -->
</html>
